<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>mshkltk - مشكلتك</title>
    <link rel="icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' fill='none'%3e%3cpath fill='%2300BFA6' d='M16 0C9.37 0 4 5.37 4 12c0 8.75 12 20 12 20s12-11.25 12-20C28 5.37 22.63 0 16 0z'/%3e%3cpath fill='%23FFFFFF' d='M16 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z'/%3e%3c/svg%3e">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;500;700;900&family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Leaflet Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Inter"', '"Rubik"', 'sans-serif'],
              arabic: ['"Cairo"', 'sans-serif'],
              display: ['"Inter"', '"Rubik"', 'sans-serif'],
            },
            colors: {
              // Light Palette
              'teal': '#00BFA6',
              'mango': '#FFA62B',
              'navy': '#0D3B66',
              'sand': '#F4EDEA',
              'sky': '#4BA3C3',
              'coral': '#FF5A5F',
              'text-primary': '#102027',
              'text-secondary': '#4B5B67',
              'card': '#FFFFFF',
              'muted': '#F8F6F4',
              'border-light': '#E6E0DC',
              // Dark Palette
              'bg-dark': '#121212',
              'surface-dark': '#1E2A38',
              'teal-dark': '#00D2B5',
              'mango-dark': '#FFB84D',
              'cyan-dark': '#5BC0EB',
              'coral-dark': '#FF767B',
              'text-primary-dark': '#E7EDF3',
              'text-secondary-dark': '#B0B8C1',
              'border-dark': '#273445',
            },
            borderRadius: {
              'xl': '1rem', // 16px
              '2xl': '1.5rem',
            },
            keyframes: {
              glow: {
                '0%, 100%': { boxShadow: '0 0 5px #FFA62B, 0 0 10px #FFA62B, 0 0 15px #FFA62B' },
                '50%': { boxShadow: '0 0 10px #FFA62B, 0 0 20px #FFA62B, 0 0 30px #FFA62B' },
              },
              'elegant-spin': {
                '0%': { transform: 'rotate(0deg)' },
                '100%': { transform: 'rotate(360deg)' },
              },
              'subtle-glow': {
                '0%, 100%': { boxShadow: '0 0 8px rgba(0, 191, 166, 0.4), 0 0 16px rgba(0, 191, 166, 0.2)' },
                '50%': { boxShadow: '0 0 16px rgba(0, 191, 166, 0.6), 0 0 24px rgba(0, 191, 166, 0.4)' },
              },
              'badge-appear': {
                '0%': { transform: 'scale(0.5) translateY(20px)', opacity: 0 },
                '100%': { transform: 'scale(1) translateY(0)', opacity: 1 },
              },
              shimmer: {
                '100%': { transform: 'translateX(100%)' },
              },
              'fade-in': {
                '0%': { opacity: 0 },
                '100%': { opacity: 1 },
              },
              'pulse-dot': {
                '0%, 100%': { opacity: 1 },
                '50%': { opacity: 0.5 },
              },
               'pulse-ring': {
                '0%': {
                  transform: 'scale(0.33)',
                  opacity: 0.8,
                },
                '80%, 100%': {
                  transform: 'scale(2)',
                  opacity: 0,
                }
              },
              'logo-pulse': {
                '0%, 100%': { transform: 'scale(1)', filter: 'drop-shadow(0 0 5px rgba(255, 166, 43, 0.4))' },
                '50%': { transform: 'scale(1.03)', filter: 'drop-shadow(0 0 15px rgba(255, 166, 43, 0.7))' },
              },
              'icon-emerge-left': {
                '0%': { transform: 'translateX(0) scale(0.5)', opacity: 0 },
                '50%': { transform: 'translateX(-120px) scale(1)', opacity: 1 },
                '100%': { transform: 'translateX(-150px) scale(0.8)', opacity: 0 },
              },
              'icon-emerge-right': {
                '0%': { transform: 'translateX(0) scale(0.5)', opacity: 0 },
                '50%': { transform: 'translateX(120px) scale(1)', opacity: 1 },
                '100%': { transform: 'translateX(150px) scale(0.8)', opacity: 0 },
              },
              'fade-out-slow': {
                '0%': { opacity: 1, transform: 'scale(1)' },
                '20%': { transform: 'scale(0.95)' },
                '100%': { opacity: 0, transform: 'scale(0.9)' },
              },
              'float-subtle': {
                '0%': { transform: 'translateY(0px) rotate(0deg)', opacity: 0.1 },
                '25%': { transform: 'translateY(-20px) rotate(8deg)', opacity: 0.5 },
                '50%': { transform: 'translateY(0px) rotate(0deg)', opacity: 0.8 },
                '75%': { transform: 'translateY(20px) rotate(-8deg)', opacity: 0.5 },
                '100%': { transform: 'translateY(0px) rotate(0deg)', opacity: 0.1 },
              },
              'icon-merge-left': {
                '0%': { transform: 'translateX(-120px) scale(1)', opacity: 1 },
                '100%': { transform: 'translateX(0) scale(0.5)', opacity: 0 },
              },
              'icon-merge-right': {
                '0%': { transform: 'translateX(120px) scale(1)', opacity: 1 },
                '100%': { transform: 'translateX(0) scale(0.5)', opacity: 0 },
              },
              'logo-fade-in': {
                '0%': { opacity: 0, transform: 'scale(0.9)' },
                '50%': { opacity: 0, transform: 'scale(0.95)' },
                '100%': { opacity: 1, transform: 'scale(1)' },
              },
            },
            animation: {
              glow: 'glow 2.5s ease-in-out infinite',
              'elegant-spin': 'elegant-spin 1s linear infinite',
              'subtle-glow': 'subtle-glow 3s ease-in-out infinite',
              'badge-appear': 'badge-appear 0.4s ease-out forwards',
              shimmer: 'shimmer 2s infinite',
              'fade-in': 'fade-in 0.3s ease-out forwards',
              'pulse-dot': 'pulse-dot 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'pulse-ring': 'pulse-ring 1.75s cubic-bezier(0.215, 0.61, 0.355, 1) infinite',
              'logo-pulse': 'logo-pulse 3s ease-in-out infinite',
              'icon-emerge-left': 'icon-emerge-left 1.5s ease-in-out forwards',
              'icon-emerge-right': 'icon-emerge-right 1.5s ease-in-out forwards',
              'fade-out-slow': 'fade-out-slow 1.5s ease-in-out forwards',
              'float-subtle': 'float-subtle 20s ease-in-out infinite',
              'icon-merge-left': 'icon-merge-left 1.5s ease-in-out forwards',
              'icon-merge-right': 'icon-merge-right 1.5s ease-in-out forwards',
              'logo-fade-in': 'logo-fade-in 1.5s ease-in-out forwards',
            }
          }
        }
      }
    </script>
     <style>
      html {
        scroll-padding-top: 4.5rem; /* Account for sticky header */
        scroll-behavior: smooth;
      }
      /* User Location Marker Styles */
      .user-location-marker {
        position: relative;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .user-location-marker .pulse {
        position: absolute;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: rgba(0, 191, 166, 0.3);
        animation: pulse-ring 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .user-location-marker .dot {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 12px;
        height: 12px;
        background: #00BFA6;
        border: 2px solid #fff;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 6px rgba(0,191,166,0.5);
      }
      @keyframes pulse-ring {
        0% {
          transform: scale(0.33);
          opacity: 0.8;
        }
        80%, 100% {
          transform: scale(2);
          opacity: 0;
        }
      }
      
      /* Wrapper classes for Leaflet divIcon markers */
      .user-location-marker-icon {
        background: transparent !important;
        border: none !important;
      }
      
      .draggable-marker-icon {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 9999 !important;
      }
      
      .report-marker-icon {
        background: transparent !important;
        border: none !important;
      }
      
      /* Draggable pin styles (light + dark) */
      .draggable-marker {
        width: 30px;
        height: 30px;
        background: #00BFA6;
        border: 3px solid #ffffff;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.25);
        cursor: grab;
        transform: translateZ(0);
        position: relative;
        flex-shrink: 0;
        transition: transform 0.1s ease-out;
      }
      
      .draggable-marker:active {
        cursor: grabbing;
        transform: scale(1.1) translateZ(0);
      }
      
      /* Slightly brighter color in dark mode */
      body.dark .draggable-marker {
        background: #00D2B5;
        box-shadow: 0 4px 14px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.12);
      }
      
      /* Ensure marker is visible above all layers */
      .leaflet-marker-draggable {
        z-index: 9999 !important;
      }
      
      .fan-cluster-icon {
        background: transparent !important;
        border: none !important;
      }
      
      html[lang="ar"] {
        /* Set Cairo as the primary font for Arabic UI, with Inter/Rubik as a fallback for Latin characters */
        font-family: '"Cairo"', '"Inter"', '"Rubik"', 'sans-serif';
      }
      /* The specific override for headings is no longer needed as the base font is correct */
      body {
        overflow-x: hidden; /* Prevent horizontal scrolling */
      }
      
      /* Custom Scrollbar for Filter Dropdown */
      .custom-scrollbar::-webkit-scrollbar {
        width: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
        margin-block: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #E6E0DC; /* border-light */
        border-radius: 10px;
        border: 2px solid #FFFFFF; /* card */
        background-clip: padding-box;
      }
      .dark .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #273445; /* border-dark */
        border-color: #1E2A38; /* surface-dark */
      }

      .live-report-icon > div {
        animation: glow 2.5s ease-in-out infinite;
      }
      /* Custom Spinner */
      .elegant-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(0, 191, 166, 0.2); /* teal with opacity */
        border-top-color: #00BFA6; /* solid teal */
        border-radius: 50%;
        animation: elegant-spin 1s linear infinite;
      }
      .dark .elegant-spinner {
        border-color: rgba(0, 210, 181, 0.2);
        border-top-color: #00D2B5;
      }
      /* Custom Leaflet Popup */
      .leaflet-popup-content-wrapper {
        background: transparent;
        box-shadow: none;
        padding: 0;
      }
      .leaflet-popup-content {
        margin: 0 !important;
      }
      .leaflet-popup-tip-container {
        display: none;
      }
      /* Custom Leaflet DivIcon for report markers */
      .report-marker-icon {
        background: transparent !important;
        border: none !important;
      }
      .report-leaflet-div-icon {
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border-style: solid;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      }
      .report-leaflet-div-icon .icon-inner {
        transform: rotate(45deg);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* New styles for Fan Clusters */
      .fan-cluster-icon {
        background: transparent !important;
        border: none !important;
      }
      .fan-cluster-container {
        position: relative;
        width: 100%;
        height: 100%;
      }
      .fan-pin-wrapper {
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 36px; /* Icon width */
        height: 36px; /* Icon height */
        margin-left: -18px; /* -width/2 */
        transform-origin: bottom center;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        transition: transform 0.2s ease-out;
      }
      .fan-pin-wrapper:hover {
        transform: scale(1.1);
      }
      .fan-pin {
        width: 100%;
        height: 100%;
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border: 3px solid white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.5);
        position: relative;
        overflow: hidden;
      }
      .fan-pin::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(255,255,255,0.3), transparent);
        border-radius: inherit;
      }
      .fan-pin .fan-icon {
        color: white;
        font-size: 16px;
        transform: rotate(45deg);
        z-index: 1;
      }
      /* Overflow Badge for Clusters */
      .fan-overflow-badge {
        position: absolute;
        bottom: -8px;
        right: -8px;
        background-color: #FF5A5F;
        color: white;
        border: 2px solid white;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 12px;
        box-shadow: 0 4px 12px rgba(255, 90, 95, 0.5), 0 2px 4px rgba(0, 0, 0, 0.3);
        z-index: 10;
      }
      /* Core Badge Hover Animation */
      .badge-hover-glow {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .badge-hover-glow:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(0, 191, 166, 0.4), 0 0 0 1px rgba(0, 191, 166, 0.1);
      }
    </style>
  </head>
  <body class="bg-sand dark:bg-bg-dark font-sans">
    <div id="root"></div>
    <div id="lightbox-root"></div>
    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>